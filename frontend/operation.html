<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operations | FEC Online</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="operation.css">
</head>

<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <span class="material-icons-round">dashboard</span>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item" title="Home">
                    <span class="material-icons-round">home</span>
                </a>
                <a href="operation.html" class="nav-item active" title="Operations">
                    <span class="material-icons-round">settings_suggest</span>
                </a>
                <a href="stock.html" class="nav-item" title="Stock">
                    <span class="material-icons-round">inventory_2</span>
                </a>
                <a href="#" class="nav-item" title="Move History">
                    <span class="material-icons-round">history</span>
                </a>
                <a href="#" class="nav-item" title="Settings">
                    <span class="material-icons-round">settings</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-bar">
                <div class="page-title">Operations</div>
                <div class="user-account">
                    <span class="material-icons-round">account_circle</span>
                </div>
            </header>

            <!-- In-page Navigation (Tabs) -->
            <nav class="inpage-nav">
                <a href="#" class="tab-link active" data-tab="receipts">Receipts</a>
                <a href="#" class="tab-link" data-tab="delivery">Delivery</a>
                <a href="#" class="tab-link" data-tab="adjustment">Adjustment</a>
                <a href="#" class="tab-link" data-tab="transfer">Internal Transfer</a>
            </nav>

            <!-- Tab Contents -->
            <section class="content-container">

                <!-- Receipts Tab -->
                <div id="receipts" class="tab-content active">
                    <div class="table-controls">
                        <button class="btn-new">NEW</button>
                        <h2 class="tab-title">Receipts</h2>
                        <div class="controls-right">
                            <button class="icon-btn"><span class="material-icons-round">search</span></button>
                            <button class="icon-btn"><span
                                    class="material-icons-round">format_list_bulleted</span></button>
                            <button class="icon-btn"><span class="material-icons-round">view_kanban</span></button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Contact</th>
                                    <th>Schedule date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="receipts-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Delivery Tab -->
                <div id="delivery" class="tab-content">
                    <div class="table-controls">
                        <button class="btn-new">NEW</button>
                        <h2 class="tab-title">Delivery</h2>
                        <div class="controls-right">
                            <button class="icon-btn"><span class="material-icons-round">search</span></button>
                            <button class="icon-btn"><span
                                    class="material-icons-round">format_list_bulleted</span></button>
                            <button class="icon-btn"><span class="material-icons-round">view_kanban</span></button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Contact</th>
                                    <th>Schedule date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="delivery-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Adjustment Tab -->
                <div id="adjustment" class="tab-content">
                    <div class="table-controls">
                        <button class="btn-new">NEW</button>
                        <h2 class="tab-title">Inventory Adjustment</h2>
                        <div class="controls-right">
                            <button class="icon-btn"><span class="material-icons-round">search</span></button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Product</th>
                                    <th>On Hand</th>
                                    <th>Counted</th>
                                    <th>Difference</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="adjustment-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Internal Transfer Tab -->
                <div id="transfer" class="tab-content">
                    <div class="table-controls">
                        <button class="btn-new">NEW</button>
                        <h2 class="tab-title">Internal Transfer</h2>
                        <div class="controls-right">
                            <button class="icon-btn"><span class="material-icons-round">search</span></button>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Product</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="transfer-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </section>
        </main>
    </div>
    <script src="api.js"></script>
    <script src="operation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {

            // Load Receipts
            async function loadReceipts() {
                const tableBody = document.getElementById('receipts-table-body');
                try {
                    const data = await api.getReceipts();
                    if (data && data.results) {
                        tableBody.innerHTML = '';
                        data.results.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="ref-col">${item.document_number}</td>
                                <td>${item.vendor_details ? item.vendor_details.name : 'Vendor'}</td>
                                <td>${item.items[0] ? item.items[0].location_details.name : '-'}</td>
                                <td class="contact-col">${item.vendor_details ? item.vendor_details.contact_person : '-'}</td>
                                <td>${item.date}</td>
                                <td class="status-ready">${item.status}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
                } catch (e) { console.error(e); }
            }

            // Load Deliveries
            async function loadDeliveries() {
                const tableBody = document.getElementById('delivery-table-body');
                try {
                    const data = await api.getDeliveries();
                    if (data && data.results) {
                        tableBody.innerHTML = '';
                        data.results.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td class="ref-col">${item.document_number}</td>
                                <td>${item.items[0] ? item.items[0].location_details.name : '-'}</td>
                                <td>${item.customer}</td>
                                <td class="contact-col">${item.customer}</td>
                                <td>${item.date}</td>
                                <td class="status-ready">${item.status}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
                } catch (e) { console.error(e); }
            }

            // Load Adjustments
            async function loadAdjustments() {
                const tableBody = document.getElementById('adjustment-table-body');
                try {
                    const data = await api.getAdjustments();
                    if (data && data.results) {
                        tableBody.innerHTML = '';
                        data.results.forEach(item => {
                            const row = document.createElement('tr');
                            // Assuming single item adjustment for simplicity in display
                            const firstItem = item.items[0] || {};
                            row.innerHTML = `
                                <td class="ref-col">${item.document_number}</td>
                                <td>${firstItem.product_details ? firstItem.product_details.name : '-'}</td>
                                <td>-</td> <!-- On Hand not directly in adjustment model -->
                                <td>${firstItem.counted_quantity}</td>
                                <td class="diff-neg">${firstItem.difference_quantity}</td>
                                <td class="status-pending">${item.status}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
                } catch (e) { console.error(e); }
            }

            // Load Transfers
            async function loadTransfers() {
                const tableBody = document.getElementById('transfer-table-body');
                try {
                    const data = await api.getTransfers();
                    if (data && data.results) {
                        tableBody.innerHTML = '';
                        data.results.forEach(item => {
                            const row = document.createElement('tr');
                            const firstItem = item.items[0] || {};
                            row.innerHTML = `
                                <td class="ref-col">${item.document_number}</td>
                                <td>${item.source_location_details ? item.source_location_details.name : '-'}</td>
                                <td>${item.destination_location_details ? item.destination_location_details.name : '-'}</td>
                                <td>${firstItem.product_details ? firstItem.product_details.name : '-'}</td>
                                <td>${firstItem.quantity}</td>
                                <td class="status-done">${item.status}</td>
                            `;
                            tableBody.appendChild(row);
                        });
                    }
                } catch (e) { console.error(e); }
            }

            // Initial Load
            loadReceipts();
            loadDeliveries();
            loadAdjustments();
            loadTransfers();
        });
    </script>
</body>

</html>